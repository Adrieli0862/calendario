<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario</title>
    <link rel="stylesheet" href="css/materialize.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/main.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<nav class="nav-center unamBlue">
    <div class="nav-wrapper container">
      <a href="#" class="brand-logo left "><img src="img/logoUnam.png"  alt=""></a>
      <a href="#" class="brand-logo right "><img src="img/logoCRAI_LT.png" alt=""></a>
      <ul>
        <li><a class="active" href="/calendar.html">Calendario</a></li>
        <li><a href="/panel.html">Panel de eventos</a></li>
        <li><a href="/usersRequests.html">Usuarios</a></li>
        <li><a href="/help.html">Ayuda</a></li>
    </ul>
    </div>
  </nav>
<body>
  <div id="fb-root"></div>
    <div id="modalAddEvent" class="modal">
        <form id="formEvent">
        <div class="modal-content container">
          <h4>Agregar evento</h4>
          <br>
        <input type="text" name="id" id="id_event" class="hide">
        <div class="input-field col s6">
            <input placeholder="Ingrese el título del evento" name="title" id="title" type="text" class="validate">
            <label for="title">Título</label>
          </div>
          <div class="input-field col s6 hide">
            <select placeholder="sede" name="sede" id="sede" id="sedes"  class="validate"  readonly>
            </select>
            <label for="sede">Sede</label>
          </div>
          <div class="input-field col s12 l6">
                <select name="type" id="type">
                    <option value="" disabled selected>Choose your option</option>
                    <option value="1">Conferencia</option>
                    <option value="2">Seminario</option>
                    <option value="3">Taller</option>
                    <option value="4"> Videoconferencias recibidas</option>
                    <option value="5">Congresos</option>
                    <option value="6">Simposios</option>
                    <option value="7">Mesas redondas</option>
                    <option value="8">Cursos</option>
                    <option value="9">Panel de expertos</option>
                    <option value="10">Foro</option>
                    <option value="11">Coloquio</option>
                    <option value="12">Diplomado</option>
                    <option value="13">Jornada</option>
                    <option value="14">Exposiciones</option>
                    <option value="15">Proyección de películas</option>
                    <option value="16">Teatro y danza</option>
                    <option value="17">Conciertos</option>
                    <option value="18">Visitas guiadas</option>
                    <option value="19">Festividades</option>
                    <option value="20">Presentación de libros</option>
                    <option value="21">Veladas literarias</option>
                    <option value="22">Muestra gastronómica</option>
                    <option value="23">Concursos</option>
                    <option value="24">Lúdico-pedagógicas</option>
                    <option value="25">Lúdico-deportivas</option>
                    <option value="26">Certificaciones de español. Por selección</option>
                </select>
                <label>Tipo de evento</label>
            </div>
            <div class="row">
                <div class="input-field col s6">
                    <input type="text" class="datepicker" name="datefrom" id="datefrom">
                    <label for="Fecha1">Fecha de Inicio</label>
                </div>
                <div class="input-field col s6">
                    <input type="text" class="datepicker" name="dateto" id="dateto">
                    <label for="Fecha2">Fecha de Termino</label>
                </div>
            </div>
            <div class="row">
                <div class="col s2">
                    <label>
                        <input name="allday" id="allday" type="checkbox" />
                        <span>Todo el día</span>
                      </label>
                </div>
                <div class="input-field col s5">
                    <input type="text" class="timepicker" name="Hora1" id="Hora1">
                    <label for="Hora1">Hora de Inicio</label>
                </div>
                <div class="input-field col s5">
                    <input type="text" class="timepicker" name="Hora2" id="Hora2">
                    <label for="Hora2">Hora de Termino</label>
                </div>
            </div>
            <div class="input-field col s6">
                <input placeholder="Ingrese la URL o dirección del evento" name="url" id="url" type="text" class="validate">
                <label for="url">Dirección</label>
              </div>
            <div class="input-field col s12 l6" >
                <div class="file-field input-field">
                    <div class="btn">
                      <span>Imagen</span>
                      <input type="file" name="picture" id="picture">
                    </div>
                    <div class="file-path-wrapper">
                      <input class="file-path validate" type="text" accept="image/*">
                    </div>
                  </div>
            </div>
            <br>
            <div class="right-align">
              <button type="button" id="formEventButton" class="unamBlue waves-effect waves-light btn">Agregar</button>

            </div>
          
        </div>
        </form>
    </div>
    <!-- Modal Structure -->
    <div id="modalDisplayEvent" class="modal">
      <div class="modal-content">
        <div class="row">
          <div class="col s7">
            <img id ="eventImage" src="" alt="" class="responsive-img">
          </div>
          <div class="col s5">
            <h4 id="eventTitle"></h4>
            <br>
            <p>Start: <span id="eventHours"></span><br>Local: <span id="eventHoursLocal"></span></p>
            <p>End: <span id="eventDay"></span><br>Local: <span id="eventDayLocal"></span></p>
            <p>Link: <a id="eventUrl">Click here</a></p>
            <p>Sede: <span id="eventSede"></span></p>
            <div class="input-field col s12 l6">
              <select name="type" id="eventType" disabled>
                  <option value="1">Conferencia</option>
                  <option value="2">Seminario</option>
                  <option value="3">Taller</option>
                  <option value="4"> Videoconferencias recibidas</option>
                  <option value="5">Congresos</option>
                  <option value="6">Simposios</option>
                  <option value="7">Mesas redondas</option>
                  <option value="8">Cursos</option>
                  <option value="9">Panel de expertos</option>
                  <option value="10">Foro</option>
                  <option value="11">Coloquio</option>
                  <option value="12">Diplomado</option>
                  <option value="13">Jornada</option>
                  <option value="14">Exposiciones</option>
                  <option value="15">Proyección de películas</option>
                  <option value="16">Teatro y danza</option>
                  <option value="17">Conciertos</option>
                  <option value="18">Visitas guiadas</option>
                  <option value="19">Festividades</option>
                  <option value="20">Presentación de libros</option>
                  <option value="21">Veladas literarias</option>
                  <option value="22">Muestra gastronómica</option>
                  <option value="23">Concursos</option>
                  <option value="24">Lúdico-pedagógicas</option>
                  <option value="25">Lúdico-deportivas</option>
                  <option value="26">Certificaciones de español. Por selección</option>
              </select>
              <label>Type</label>
              <br>
            <a href="#!" class="modal-action modal-close unamBlue white-text btn-flat">Close</a>
            <p><div class="fb-share-button"><a id="fbShare" class="waves-effect btn light-blue darken-3" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-facebook" viewBox="0 0 16 16">
              <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
            </svg> Compartir</a></div></p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <main class="container">
        <br>
        <ul class="collection">
          <li class="collection-item avatar">
              <i class="material-icons circle">person</i>
              <span class="title" id="SedeName">UNAM Costa Rica</span>
              <p ><span id="usr"></span> <br>
                <span id="typeUsr"></span>
              </p>
              <button id="closesession" class="btn secondary-content red-text grey lighten-5">Cerrar sesión<i class="material-icons">call_missed</i></button>
          </li>
        </ul>
        <br>
        <div class="card">
            <div class="card-image">
                <ul id="yearSelect" class="dropdown-content">
                </ul>
                <ul id="schoolSelect" class="dropdown-content">
                  <li><a href="#!" value="">-</a></li>
                </ul>
                <nav class="nav-extended unamBlue">
                    <div class="nav-wrapper">
                      <a href="#!" class="brand-logo">Calendario</a>
                      <ul class="right hide-on-med-and-down">
                        <li>
                          <div class="input-field ">
                            <i class="material-icons prefix">search</i>
                            <input id="searchEvent" type="text">
                            <label for="searchEvent">Search</label>
                          </div>
                        </li>
                        <li><a class="dropdown-trigger" href="#!" data-target="schoolSelect" id="school"><span id="schoolLabel">-</span><i class="material-icons right">school</i></a></li>
                        <li><a href="#!" id="settings"><i class="material-icons">settings</i></a></li>
                        <li><a class="dropdown-trigger" href="#!" data-target="yearSelect" id="yearLabel">Dropdown<i class="material-icons right">arrow_drop_down</i></a></li>
                      </ul>
                    </div>
                    <div class="nav-content">
                        <ul class="tabs tabs-transparent">
                          <li class="tab"><a href="#Mes">Mes</a></li>
                          <li class="tab"><a href="#Dia">Dia</a></li>
                          <li class="tab "><a href="#Semana">Semana</a></li>
                        </ul>
                        <a class="btn-floating btn-large halfway-fab waves-effect waves-light gold modal-trigger" href="#modalAddEvent">
                            <i class="material-icons">add</i>
                        </a>
                      </div>
                  </nav>
            </div> 
            <div class="card-content">
                  <div id="Mes"><div class="calendar row"></div></div>
                  <div id="Dia">Día</div>
                  <div id="Semana"><div id = "calendarSemana" class="row"></div></div>
            </div>
          </div>
    </main>
    
</body>
<footer class="page-footer unamBlue white-text">
  <div class="container">
    <div class="row">
      <div class="col s12 m6">
        
          <h5 class="widgetheading">Contáctanos</h5>
         
          <strong>Coordinación de Relaciones y Asuntos Internacionales</strong><br>
           Edificio CIPPS - Centro de Investigación en Población, Políticas y Salud<br>
           Planta Baja, Unidad Internacional de Sedes Universitarias<br>
           Circuito Cultural s/n <br>
           Ciudad Universitaria, México, D.F.<br>
           C.P. 04510	 

          <p>
            <i class="icon-phone"></i> (+52) 56226666 - Ext. 82270 <br>
            <i class="icon-envelope-alt"></i> crai@unam.mx
          </p>
        
      </div>
      <div class="col s12 m3">
          <h5 class="widgetheading">Sitios de Interés</h5>
          <ul class="link-list">
            <li><a class="gold-text" href="http://www.cepe.unam.mx/" target="_blank">CEPE</a></li>
            <li><a class="gold-text" href="http://www.global.unam.mx/" target="_blank">DGECI</a></li>
            <li><a class="gold-text" href="https://www.unam.mx/" target="_blank">UNAM</a></li>
            <li><a class="gold-text" href="http://www.redmacro.unam.mx/" target="_blank">REDMACRO</a></li>
            <li><a class="gold-text" href="uisu.html" target="_blank">UISU</a></li>
            <li><a class="gold-text" href="https://siele.org/" target="_blank">SIELE</a></li>
          </ul>
          <br>
          <b><a class="gold-text" href="noticias/AvisoPrivacidadCRAI.pdf" target="_blank"> AVISO DE PRIVACIDAD </a></b>
        
      </div>
      <div class="col s12 m3">
       
          <h5 class="widgetheading">Venir a estudiar a la UNAM</h5>
          <ul class="link-list">
            <li><a  class="gold-text" href="mailto:info@global.unam.mx?subject=Contact%20from%20the%20Web%20Page">info@global.unam.mx</a></li>					
          </ul>

          <div class="widget"><br>
            <img src="img/firmaUNAMs.png">
          </div>
      </div>
        
      
      
    </div>
  </div>
<div class=" white-text">
  <hr>
  <div class="row">
    <div class="col s12 m6 center-align"><p>Sitio Administrado por UNAM Costa Rica <br><a class="gold-text" href="mailto:unamcostarica@gmail.com">unamcostarica@gmail.com</a></p></div>
    <div class="col s12 m6 center-align"><p>© 2022 Coordinación de Relaciones y Asuntos Internacionales :: CRAI-UNAM - All Rights Reserved<br>Creado median el programa de prácticas profesionales de la FCA</p></div>
  </div>
</div>
</footer>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/calendario.js"></script>
  <script src="js/events.js"></script>
  <script>
    var filters={sede:'',name:''}
     var usr;
     function getCookie(cname) {
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for(var i = 0; i < ca.length; i++) {
          var c = ca[i];
          while(c.charAt(0) == ' ') c = c.substring(1);
          if(c.indexOf(name) == 0) return c.substring(name.length, c.length);
        }
        return null;
      }
      (function(){
          if ((u=getCookie('authkey'))==null) 
            location.replace('/signIn.html');
          else
            $.ajax('data/users/'+u+'.json').done(function(jsondata){
              usr=jsondata.user;
              $('#usr').text(usr.usr);
              sede =usr.id_sede;
              $.ajax('api/sedes?authkey='+u).done(function (response) {
                sedes={}
                  response.forEach(element => {
                      sedes[element.id]=element;
                      if(element.id===sede) $('#SedeName').text(element.nombre)
                      schoolSelect
                      $('#sedes').append('<option value="'+element.id+'" '+(element.id==sede?'selected':'')+'>'+element.nombre+'</>')
                      $('#schoolSelect').append('<li><a value="'+element.id+'" href="#!">'+element.nombre+'</a></li>')
                  });
                  $('#schoolSelect a').click(function (e) {
                    filters.sede=e.target.getAttribute('value');
                    if(filters.sede!='')
                      schoolLabel.innerText=sedes[filters.sede].nombre;
                    else
                      schoolLabel.innerText="-"
                    loadLocalEvents(filters);
                  });
              })
              $('#searchEvent').change(function (e) {
                  filters.name=e.target.value;
                  loadLocalEvents(filters);
              });
              
              
              $('#typeUsr').text(usr.status==1?'regular':'admin');
              drawCalendar();
              drawWeek();
              drawDay();
              loadEvents();
              $('.dropdown-trigger').dropdown();
              $(document).ready(function(){
                  $('.modal').modal();
              });
              $(document).ready(function(){
                  $('select').formSelect();
              });
              $(document).ready(function(){
                  $('.datepicker').datepicker({format: 'yyyy-mm-dd'});
              });
              $(document).ready(function(){
                  $('.timepicker').timepicker({
                    twelveHour: false
                  });
              });
              $('#todoElDia').change(function(event){
                  checked = event.target.checked;
                      $('.timepicker').prop('disabled',checked);
                      $('.timepicker').prop('readonly',!checked);
              });
              $('#yearSelect li a').click(function(event){
                  actualYear = event.target.innerHTML;
                  drawCalendar();
                  drawWeek(actualYear+'-'+(actualMonth+1).toString().padStart(2, "0")+'-01');
                  drawDay(actualYear+'-'+(actualMonth+1).toString().padStart(2, "0")+'-01');
              });
            }).fail(function(e){
              location.replace('/signIn.html');
            });
        })();
        $('#closesession').click(function (params) {
          const key = getCookie('authkey');
          if (!key) location.replace('/signIn.html'); 
          else document.cookie = "authkey=; expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;";
          return $.ajax({
                    url: '/api/auth?authkey=' + key,
                    type: 'DELETE',
                    contentType:'application/json',  
                    dataType: 'text',                
                    success: setTimeout(function(){location.replace('/signIn.html')}, 100),
                });
        }
        );
  </script>
</html>